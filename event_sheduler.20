## AUTOMATIZANDO O PROCESSO ATRAVÉS DE EVENT SCHEDULER

-- PROGRAMANDO A PROCEDURE PARA EXECUTAR UMA VEZ POR SEMANA.
-- HABILITANDO O EVENT_SCHEDULER NO SGBD MYSQL.

SET GLOBAL EVENT_SCHEDULER = ON;
Query OK, 0 rows affected (0.09 sec)

-- NOS PARÊMETROS DA PROCEDURE, UTILIZO A FUNÇÃO DE DATA CURRENT_DATE() 
-- QUE RETORNA A DATA ATUAL, O OBJETIVO É PROCESSAR AS VENDAS DA SEMANA.

DELIMITER $$ 
CREATE EVENT PROCESSA_COMISSAO
ON SCHEDULE EVERY 1 WEEK STARTS '2015-03-01'
DO
	BEGIN 
	  CALL PROCESSA_COMISSAO(
	  	  CURRENT_DATE() - INTERVAL 7 DAY,
	    CURRENT_DATE(), @A );
	END 
$$
DELIMITER ;

-- CONSULTANDO O RESULTADO DAS VENDAS DESSE PERÍODO.

SELECT C_CODIVENDA CODIGO,
	   N_TOTAVENDA TOTAL,
	   N_TOTAVENDA COMISSAO 
	FROM COMVENDA
  WHERE 
  	D_DATAVENDA BETWEEN CURRENT_DATE() - INTERVAL 60 DAY
  	AND CURRENT_DATE();

## OS EVENTOS PODEM SER EXECUTADOS EM OUTRAS PERIODICIDADES.

-- ON SCHEDULE EVERY 1 YEAR: UMA VEZ POR ANO;
-- ON SCHEDULE EVERY 1 MONTH: UMA VEZ POR MÊS;
-- ON SCHEDULE EVERY 1 DAY: UMA VEZ POR DIA;
-- ON SCHEDULE EVERY 1 HOUR: UMA VEZ POR HORA;
-- ON SCHEDULE EVERY 1 MINUTE: UMA VEZ POR MINUTE;
-- ON SCHEDULE EVERY 1 SECOND: UMA VEZ POR SEGUNDO;

## CRIANDO UMA PROCEDURE QUE INICIARÁ A CADA 10 MINUTOS E PARAR DEPOIS DE UMA HORA.

DELIMITER $$ 
CREATE EVENT PROCESSA_COMISSAO_EVENT
ON SCHEDULE EVERY 10 MINUTE
STARTS CURRENT_TIMESTAMP
ENDS CURRENT_TIMESTAMP + INTERVAL 30 MINUTE
DO 
 BEGIN
 CALL PROCESSA_COMISSIONAMENTO(
 	  CURRENT_DATE() - INTERVAL 7 DAY,
 	CURRENT_DATE(),
 	@A);
END
$$
Query OK, 0 rows affected (0.22 sec)
DELIMITER ;

## AO CRIAR UM EVENTO, ELE FICA HABILITADO AUTOMATICAMENTE.
## DESABILITANDO O EVENTO

ALTER EVENT PROCESSA_COMISSAO_EVENT DISABLE;
Query OK, 0 rows affected (0.11 sec)

-- HABILITANDO O EVENT NOVAMENTE:
ALTER EVENT PROCESSA_COMISSAO_EVENT ENABLE;
Query OK, 0 rows affected (0.09 sec)

