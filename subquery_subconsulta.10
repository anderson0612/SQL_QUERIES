# SUBQUERY OU SUBCONSULTA

# AS SUBCONSULTAS SÃO ALTERNATIVAS PARA JOINS, QUE VAMOS VER LOGO A  SEGUIR.
# COM A SUBCONSULTAS, CONSEGUIMOS TER UM SELECT DENTRO DE OUTRO SELECT
# PARA NOS AJUDAR A RECUPERAR REGISTROS QUE ESTÃO REFERENCIADOS EM OUTRAS TABELAS.
# ANTES DAS SUBQUERYS, VAMOS APREDER AS CLÁUSULAS IN, NOT IN, EXISTIS E NOT EXISTS,
# PARA CRIAR VERIFICAÇÕES PARA NOSSAS CONSULTAS.

# CLÁUSULAS IN E NOT IN 

SELECT C_CODICLIEN, C_RAZACLIEN
	FROM COMCLIEN
  WHERE N_NUMECLIEN = 1,2;	

ERROR 1064 (42000): You have an error in your SQL syntax;

# TEMOS UM ERRO. APENAS UTILIZAREMOS O SINAL DE = QUANDO A COMPARAÇÃO FOR SÓ COM UM VALOR.
# JÁ AS CLÁUSULAS IN E NOT IN SURGEM PARA FORNECER APOIO QUANDO QUEREMOS TESTAR UM OU MAIS VALORES.

SELECT C_CODICLIEN, C_RAZACLIEN
	FROM COMCLIEN
  WHERE N_NUMECLIEN IN (1,2);

  +-------------+------------------------+
| C_CODICLIEN | C_RAZACLIEN            |
+-------------+------------------------+
| 0001        | AARONSON FURNITURE LTD |
| 0002        | LITTLER  LTDA          |
+-------------+------------------------+

# PODEMOS CONSULTAR CLIENTES QUE POSSUEM O VALOR DIFERENTE DE 1 E 2 UTILIZANDO O NOT IN.

SELECT C_CODICLIEN, C_RAZACLIEN
	FROM COMCLIEN
		WHERE N_NUMECLIEN NOT IN (1,2);

+-------------+-----------------------+
| C_CODICLIEN | C_RAZACLIEN           |
+-------------+-----------------------+
| 0003        | KELSEY  NEIGHBOURHOOD |
| 0004        | GREAT AMERICAN MUSIC  |
| 0005        | LIFE PLAN COUNSELLING |
| 0006        | PRACTI-PLAN LTDA      |
| 0007        | SPORTSWEST LTDA       |
| 0008        | HUGHES MARKETS LTDA   |
| 0009        | AUTO WORKS LTDA       |
| 00010       | DAHLKEMPER  LTDA      |
+-------------+-----------------------+

# VAMOS RETORNAR A RAZÃO SOCIAL DOS CLIENTES QUE POSSUEM REGISTROS NA TABELA COMVENDA.
# VAMOS UTILIZAR UMA SUBCONSULTA, ONDE A PRINCIPAL RETORNARÁ A RAZÃO SOCIAL DO CLIENTE
# E VAI COMPARAR O NÚMERO DO CLIENTE QUE SERÁ RETORNADO PELA SUBCONSULTA.
# ESTA, POR SUA VEZ, RETORNARÁ TODOS OS NÚMEROS DA TABELA COMVENDA, UTILIZANDO A CLÁUSULA IN
# E A SUBCONSULTA ENTRE PARÊNTESES.

SELECT C_RAZACLIEN
	FROM COMCLIEN
	 WHERE N_NUMECLIEN IN (SELECT N_NUMECLIEN
	 							FROM COMVENDA
	 							WHERE N_NUMECLIEN);

+------------------------+
| C_RAZACLIEN            |
+------------------------+
| AARONSON FURNITURE LTD |
| LITTLER  LTDA          |
| KELSEY  NEIGHBOURHOOD  |
| GREAT AMERICAN MUSIC   |    
| LIFE PLAN COUNSELLING  |
| PRACTI-PLAN LTDA       |
| SPORTSWEST LTDA        |
| HUGHES MARKETS LTDA    |
| AUTO WORKS LTDA        |
+------------------------+

# VAMOS BUSCAR OS CLIENTES QUE AINDA NÃO FIZERAM NENHUMA VENDA. PARA ISSO, UTILIZAREMOS O NOT IN.
# O ÚNICO CLIENTE QUE NÃO POSSUI REGISTRO DE VENDA RETORNARÁ.
# A CONSULTA PRINCIAL VAI CONSULTAR TODOS OS REGISTROS QUE NÃO POSSUEM O NÚMERO NA TABELA COMVENDA.

SELECT C_RAZACLIEN 
	FROM COMCLIEN
	WHERE N_NUMECLIEN NOT IN (SELECT N_NUMECLIEN
								FROM COMVENDA);
+------------------+
| C_RAZACLIEN      |
+------------------+
| DAHLKEMPER  LTDA |
+------------------+
1 row in set (0.00 sec)


# EM NOSSO SISTEMA, SURGIU A NECESSIDADE DE DESENVOLVER UMA CONSULTA PARA RETORNAR O CÓDIGO DAS VERNDAS
# E A RAZÃO SOCIAL DOS RESPECTIVOS CLIENTES QUE AS FIZERAM.

# A CONSULTA PRINCIPAL SERÁ UM SELECT NA TABELA COMVENDA JUNTO COM UMA SUBCONSULTA.
# ESTA TERÁ UMA VÍRGULA SEPARANDO-A DO PRIMEIRO CAMPO E O N_NUMECLIEN SENDO PASSADO DA CONSULTA PRINCIPAL,
# PARA REALIZAR A COMPARAÇÃO E BUSCAR A RAZÃO SOCIAL DO RESPECTIVO CLIENTE.

SELECT C_CODIVENDA COD_VENDA,
	(SELECT C_RAZACLIEN
		FROM COMCLIEN
		WHERE N_NUMECLIEN = COMVENDA.N_NUMECLIEN) NOME_CLIENTE
	FROM COMVENDA;

# ESSA MANEIRA NÃO É MUITO USADA, PORQUE HÁ PERDA DE PERFORMANCE E O CÓDIGO NÃO FICA LEGAL.
# POR ISSO, É NECESSÁRIO FAZER JOINS: A FORMA CORRETA PARA RETORNARMOS VALORES
# DE UMA OU MAIS TABELAS EM UM ÚNICO SELECT.
+-----------+------------------------+
| COD_VENDA | NOME_CLIENTE           |
+-----------+------------------------+
| 1         | AARONSON FURNITURE LTD |
| 2         | LITTLER  LTDA          |
| 3         | KELSEY  NEIGHBOURHOOD  |
| 4         | GREAT AMERICAN MUSIC   |
| 5         | LIFE PLAN COUNSELLING  |
| 6         | PRACTI-PLAN LTDA       |
| 7         | SPORTSWEST LTDA        |
| 8         | HUGHES MARKETS LTDA    |
| 9         | AUTO WORKS LTDA        |
| 10        | AARONSON FURNITURE LTD |
| 11        | AARONSON FURNITURE LTD |
| 12        | LITTLER  LTDA          |
| 13        | KELSEY  NEIGHBOURHOOD  |
| 14        | KELSEY  NEIGHBOURHOOD  |
| 15        | LIFE PLAN COUNSELLING  |
| 16        | PRACTI-PLAN LTDA       |
| 17        | SPORTSWEST LTDA        |
| 18        | HUGHES MARKETS LTDA    |
| 19        | AUTO WORKS LTDA        |
| 20        | AUTO WORKS LTDA        |
+-----------+------------------------+

